<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetonor Web - Juega y Aprende</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f2f5; padding: 20px; color: #333; }
        .game-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; }
        h1 { color: #007bff; margin-bottom: 20px; }
        .stats { display: flex; justify-content: space-between; width: 100%; margin-bottom: 20px; font-weight: bold; color: #555; }
        .grid { display: grid; grid-template-columns: repeat(5, 60px); grid-gap: 10px; align-items: center; justify-items: center; }
        .cell { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }
        input { width: 45px; height: 45px; text-align: center; border: 2px solid #ddd; border-radius: 8px; font-size: 1.2rem; color: #007bff; transition: 0.3s; }
        input:focus { border-color: #007bff; outline: none; box-shadow: 0 0 5px rgba(0,123,255,0.5); }
        .op { color: #888; font-size: 1.4rem; }
        .res { color: #333; background: #e9ecef; border-radius: 8px; }
        .controls { margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-check { background: #28a745; }
        .btn-hint { background: #ffc107; color: #333; }
        .btn-reset { background: #6c757d; }
        .btn-new { background: #007bff; }
        .btn-info { background: #17a2b8; }
        .btn:hover { opacity: 0.9; transform: scale(1.05); }
        #message { margin-top: 15px; font-weight: bold; min-height: 24px; }
        .correct { border-color: #28a745 !important; background-color: #d4edda; color: #155724; }

        /* Estilos para la secci√≥n de informaci√≥n */
        #info-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
            text-align: left;
            display: none; /* Oculto por defecto */
        }
        #info-section h2 { color: #007bff; margin-bottom: 15px; }
        #info-section h3 { color: #333; margin-top: 20px; margin-bottom: 10px; }
        #info-section ul { list-style-type: disc; margin-left: 20px; margin-bottom: 15px; }
        #info-section ol { list-style-type: decimal; margin-left: 20px; margin-bottom: 15px; }
        #info-section p { line-height: 1.6; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>Tetonor Web</h1>
        
        <div class="stats">
            <div>Tiempo: <span id="timer">00:00</span></div>
            <div id="level">Nivel: Aleatorio</div>
        </div>

        <div id="grid" class="grid"></div>
        
        <div id="message"></div>

        <div class="controls">
            <button class="btn btn-check" onclick="checkGame()">Comprobar</button>
            <button class="btn btn-hint" onclick="getHint()">üí° Pista</button>
            <button class="btn btn-reset" onclick="resetCurrent()">Reiniciar</button>
            <button class="btn btn-new" onclick="initGame()">Nuevo Juego</button>
            <button class="btn btn-info" onclick="toggleInfo()">‚ÑπÔ∏è Info / Ayuda</button>
        </div>
    </div>

    <div id="info-section">
        <h2>Reglas del Juego Tetonor</h2>
        <p>El **Tetonor** es un desaf√≠o matem√°tico que pondr√° a prueba tu l√≥gica y tus habilidades num√©ricas. El objetivo es simple:</p>
        
        <h3>Objetivo:</h3>
        <ul>
            <li>Rellenar todas las casillas vac√≠as (las que tienen un cuadro de texto) con n√∫meros del **1 al 9**.</li>
            <li>Debes asegurarte de que todas las operaciones matem√°ticas (sumas, restas, multiplicaciones) sean correctas, tanto en horizontal como en vertical.</li>
            <li>Se deben respetar los operadores y el orden de izquierda a derecha en las filas y de arriba hacia abajo en las columnas.</li>
        </ul>

        <h3>Consejos para Resolver:</h3>
        <ol>
            <li>**Empieza por lo f√°cil:** Busca las operaciones que ya tienen la mayor√≠a de los n√∫meros revelados o que solo tienen una casilla vac√≠a. Por ejemplo, si tienes "5 + [ ] = 8", sabes que el n√∫mero es 3.</li>
            <li>**Multiplicaciones y divisiones:** A menudo son las m√°s restrictivas. Si tienes "X * [ ] = Y", las opciones para el n√∫mero desconocido suelen ser pocas. ¬°Aprov√©chalas!</li>
            <li>**Intersecciones:** Un n√∫mero puede ser parte de una operaci√≥n horizontal y una vertical. Si encuentras un n√∫mero en una operaci√≥n, verifica c√≥mo afecta a la otra operaci√≥n que lo cruza.</li>
            <li>**Prueba y error (con cabeza):** Si est√°s atascado, haz una suposici√≥n educada para una casilla y mira si puedes seguir resolviendo. Si llegas a una contradicci√≥n, sabr√°s que tu suposici√≥n original era incorrecta.</li>
            <li>**Utiliza el bot√≥n "Reiniciar":** Si crees que te has equivocado en alguna parte, puedes borrar tus entradas y volver a empezar con el mismo tablero.</li>
            <li>**El bot√≥n "Pista":** Si est√°s muy perdido, el bot√≥n "üí° Pista" te revelar√° una de las respuestas correctas. ¬°√ösalo con moderaci√≥n para desafiarte a ti mismo!</li>
        </ol>
        <p>¬°Mucha suerte y divi√©rtete mejorando tu agilidad mental!</p>
    </div>

    <script>
        let solution = {};
        let seconds = 0;
        let timerInterval;

        function startTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                seconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function updateTimerDisplay() {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${m}:${s}`;
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function initGame() {
            const grid = document.getElementById('grid');
            const message = document.getElementById('message');
            grid.innerHTML = '';
            message.textContent = '';
            startTimer();

            // L√≥gica de generaci√≥n mejorada
            // Aseguramos que los n√∫meros sean v√°lidos y permitan soluciones
            let f1_a, f1_b, f1_sum, col1_d, col1_res, f2_e, f2_f;

            do { // Loop para asegurar que la divisi√≥n sea posible y los resultados est√©n entre 1 y 9
                f1_a = getRandomInt(2, 9); // Para que la multiplicaci√≥n sea interesante
                f1_b = getRandomInt(1, 9);
                f1_sum = f1_a + f1_b;

                col1_d = getRandomInt(2, 5); // Para que la multiplicaci√≥n no sea demasiado grande
                col1_res = f1_a * col1_d;

                f2_e = getRandomInt(1, 9); 
                f2_f = col1_d - f2_e; 
                // Asegurarse que f2_f sea positivo y distinto de 0
            } while (f1_sum > 18 || col1_res > 81 || f2_f <= 0 || f2_f > 9); // Ajuste de rangos para la validez

            solution = { 
                f1_b: f1_b, 
                col1_d: col1_d, 
                f2_e: f2_e, 
                f2_f: f2_f,
                sum_mid: f1_b + f2_e,
                total: f1_sum + f2_f
            };
            
            // Ajustar si las sumas finales se salen del rango 1-18
            if (solution.sum_mid > 18) { // Si la suma central es muy alta, regenerar
                return initGame(); 
            }
            if (solution.total > 18) { // Si la suma final es muy alta, regenerar
                return initGame();
            }


            const cells = [
                {type: 'val', val: f1_a}, {type: 'op', val: '+'}, {type: 'input', id: 'f1_b'}, {type: 'op', val: '='}, {type: 'res', val: f1_sum},
                {type: 'op', val: '√ó'}, {type: 'empty'}, {type: 'op', val: '+'}, {type: 'empty'}, {type: 'op', val: '+'},
                {type: 'input', id: 'col1_d'}, {type: 'op', val: '-'}, {type: 'input', id: 'f2_e'}, {type: 'op', val: '='}, {type: 'input', id: 'f2_f'},
                {type: 'op', val: '='}, {type: 'empty'}, {type: 'op', val: '='}, {type: 'empty'}, {type: 'op', val: '='},
                {type: 'res', val: col1_res}, {type: 'empty'}, {type: 'input', id: 'sum_mid'}, {type: 'empty'}, {type: 'input', id: 'total'}
            ];

            cells.forEach(cell => {
                const div = document.createElement('div');
                div.className = 'cell';
                if(cell.type === 'val' || cell.type === 'res') {
                    div.classList.add('res');
                    div.textContent = cell.val;
                } else if(cell.type === 'op') {
                    div.classList.add('op');
                    div.textContent = cell.val;
                } else if(cell.type === 'input') {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = "1";
                    input.max = "9";
                    input.maxLength = "1"; // Para asegurar solo un d√≠gito visualmente
                    input.id = cell.id;
                    div.appendChild(input);
                }
                grid.appendChild(div);
            });
        }

        function checkGame() {
            let allFilled = true;
            let correctCount = 0;
            let totalInputs = 0;
            
            for (let key in solution) {
                totalInputs++;
                const input = document.getElementById(key);
                if (input && input.value !== '') { // Asegurarse de que el input exista y no est√© vac√≠o
                    if (parseInt(input.value) === solution[key]) {
                        input.classList.add('correct');
                        correctCount++;
                    } else {
                        input.classList.remove('correct');
                        allFilled = false; // Aunque est√© lleno, si es incorrecto, no est√° "bien"
                    }
                } else {
                    input.classList.remove('correct');
                    allFilled = false; // Si hay alguno vac√≠o, no est√° todo completo
                }
            }

            const msg = document.getElementById('message');
            if (correctCount === totalInputs && allFilled) { // Todos llenos y todos correctos
                clearInterval(timerInterval);
                msg.textContent = `¬°Felicidades! Lo lograste en ${document.getElementById('timer').textContent}`;
                msg.style.color = "green";
                setTimeout(initGame, 3000); // Nuevo juego despu√©s de 3 segundos
            } else {
                msg.textContent = "Revisa los campos incorrectos o vac√≠os...";
                msg.style.color = "red";
            }
        }

        function getHint() {
            const keys = Object.keys(solution);
            const emptyInputs = keys.filter(k => {
                const input = document.getElementById(k);
                return input && input.value === '';
            });
            
            if (emptyInputs.length > 0) {
                const randomKey = emptyInputs[Math.floor(Math.random() * emptyInputs.length)];
                const input = document.getElementById(randomKey);
                input.value = solution[randomKey];
                input.classList.add('correct');
                document.getElementById('message').textContent = "¬°Una pista revelada!";
                document.getElementById('message').style.color = "blue";
            } else {
                document.getElementById('message').textContent = "¬°Ya est√°n todos los n√∫meros en el tablero!";
                document.getElementById('message').style.color = "orange";
            }
        }

        function resetCurrent() {
            for (let key in solution) {
                const input = document.getElementById(key);
                if (input) { // Asegurarse de que el input exista
                    input.value = '';
                    input.classList.remove('correct');
                }
            }
            document.getElementById('message').textContent = "Tablero limpiado.";
            document.getElementById('message').style.color = "black";
        }

        function toggleInfo() {
            const infoSection = document.getElementById('info-section');
            if (infoSection.style.display === 'none' || infoSection.style.display === '') {
                infoSection.style.display = 'block';
            } else {
                infoSection.style.display = 'none';
            }
        }

        window.onload = initGame;
    </script>
</body>
</html>
